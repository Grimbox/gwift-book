== Boite √† outils

=== Python

Le langage https://www.python.org/[Python] est un https://docs.python.org/3/faq/general.html#what-is-python[langage de programmation] interpr√©t√©, interactif, orient√© objet (souvent), fonctionnel (parfois), open source, multi-plateformes, flexible, facile √† apprendre et difficile √† ma√Ætriser.

.https://xkcd.com/353/
image::images/xkcd-353-python.png[]

A premi√®re vue, certains concepts restent difficiles √† aborder: l'indentation d√©finit l'√©tendue d'un bloc (classe, fonction, m√©thode, boucle, condition, ...), il n'y a pas de typage fort des variables et le compilateur n'est pas l√† pour assurer le filet de s√©curit√© avant la mise en production (puisqu'il n'y a pas de compilateur üòõ).
Et malgr√© ces quelques points, Python reste un langage g√©n√©raliste accessible et "bon partout", et de pouvoir se reposer sur un √©cosyst√®me stable et fonctionnel.

Il fonctionne avec un syst√®me d'am√©liorations bas√©es sur des propositions: les PEP, ou "**Python Enhancement Proposal**".
Chacune d'entre elles doit √™tre approuv√©e par le http://fr.wikipedia.org/wiki/Benevolent_Dictator_for_Life[Benevolent Dictator For Life].

Si vous avez besoin d'un aide-m√©moire ou d'une liste exhaustive des types et structures de donn√©es du langage, r√©f√©rez-vous au lien suivant: https://gto76.github.io/python-cheatsheet/[Python Cheat Sheet].

NOTE: Le langage Python utilise un typage dynamique appel√© https://fr.wikipedia.org/wiki/Duck_typing[*duck typing*]: "_When I see a bird that quacks like a duck, walks like a duck, has feathers and webbed feet and associates with ducks ‚Äî I‚Äôm certainly going to assume that he is a duck_" (Source: http://en.wikipedia.org/wiki/Duck_test[Wikipedia (as usual)]).

==== PEP8 - Style Guide for Python Code

La premi√®re PEP qui va nous int√©resser est la https://www.python.org/dev/peps/pep-0008/[PEP 8 -- Style Guide for Python Code]. Elle sp√©cifie comment du code Python doit √™tre organis√© ou format√©, quelles sont les conventions pour l‚Äôindentation, le nommage des variables et des classes, ...
En bref, elle d√©crit comment √©crire du code proprement, afin que d‚Äôautres d√©veloppeurs puissent le reprendre facilement, ou simplement que votre base de code ne d√©rive lentement vers un seuil de non-maintenabilit√©.

Dans cet objectif, un outil existe et listera l'ensemble des conventions qui ne sont pas correctement suivies dans votre projet: pep8. Pour l'installer, passez par pip. Lancez ensuite la commande pep8 suivie du chemin √† analyser (`.`, le nom d'un r√©pertoire, le nom d'un fichier `.py`, ...). Si vous souhaitez uniquement avoir le nombre d'erreur de chaque type, saisissez les options `--statistics -qq`.


[source,bash]
----
$ pep8 . --statistics -qq

7       E101 indentation contains mixed spaces and tabs
6       E122 continuation line missing indentation or outdented
8       E127 continuation line over-indented for visual indent
23      E128 continuation line under-indented for visual indent
3       E131 continuation line unaligned for hanging indent
12      E201 whitespace after '{'
13      E202 whitespace before '}'
86      E203 whitespace before ':'
----

Si vous ne voulez pas √™tre d√©rang√© sur votre mani√®re de coder, et que vous voulez juste avoir un retour sur une analyse de votre code, essayez `pyflakes`: cette librairie analysera vos sources √† la recherche de sources d'erreurs possibles (imports inutilis√©s, m√©thodes inconnues, etc.).

Il existe une solution qui couvre ces deux domaines: https://github.com/PyCQA/flake8[flake8].
Sur base de la m√™me interface que `pep8`, vous rencontreez en plus tous les avantages li√©s √† `pyflakes`


==== PEP257 - Docstring Conventions

Python √©tant un langage interpr√©t√© fortement typ√©, il est plus que conseill√©, au m√™me titre que les tests unitaires, de documenter son code.
Cela impose une certaine rigueur, mais am√©liore √©norm√©ment la qualit√© (et la reprise) du code par une tierce personne. Cela implique aussi de **tout** documenter: les modules, les paquets, les classes, les fonctions, m√©thodes, ... Tout doit avoir un *docstring* associ√© :-).

WARNING: Documentation: be obsessed!

Il existe plusieurs types de conventions de documentation:

. PEP 257
. Numpy
. Google Style (parfois connue sous l'intitul√© `Napoleon`)
. ...

Les https://google.github.io/styleguide/pyguide.html#38-comments-and-docstrings[conventions propos√©es par Google] nous semblent  plus faciles √† lire que du RestructuredText, mais sont parfois moins bien int√©gr√©es que les docstrings officiellement support√©es (typiquement, par exemple par https://clize.readthedocs.io/en/stable/[clize] qui ne reconnait que du RestructuredText).
L'exemple donn√© dans les styleguide est celui-ci:

[source,python]
----
def fetch_smalltable_rows(table_handle: smalltable.Table,
                          keys: Sequence[Union[bytes, str]],
                          require_all_keys: bool = False,
) -> Mapping[bytes, Tuple[str]]:
    """Fetches rows from a Smalltable.

    Retrieves rows pertaining to the given keys from the Table instance
    represented by table_handle.  String keys will be UTF-8 encoded.

    Args:
        table_handle: An open smalltable.Table instance.
        keys: A sequence of strings representing the key of each table
          row to fetch.  String keys will be UTF-8 encoded.
        require_all_keys: Optional; If require_all_keys is True only
          rows with values set for all keys will be returned.

    Returns:
        A dict mapping keys to the corresponding table row data
        fetched. Each row is represented as a tuple of strings. For
        example:

        {b'Serak': ('Rigel VII', 'Preparer'),
         b'Zim': ('Irk', 'Invader'),
         b'Lrrr': ('Omicron Persei 8', 'Emperor')}

        Returned keys are always bytes.  If a key from the keys argument is
        missing from the dictionary, then that row was not found in the
        table (and require_all_keys must have been False).

    Raises:
        IOError: An error occurred accessing the smalltable.
    """
----

C'est-√†-dire:

. Une courte ligne d'introduction, descriptive, indiquant ce que la fonction ou la m√©thode r√©alise. Attention, la documentation ne doit pas indiquer _comment_ la fonction/m√©thode est impl√©ment√©e, mais ce qu'elle fait concr√®tement (et succintement).
. Une ligne vide
. Une description plus compl√®te et plus verbeuse
. Une ligne vide
. La description des arguments et param√®tres, des valeurs de retour (+ exemples) et les exceptions qui peuvent √™tre lev√©es.

Un exemple (encore) plus complet peut √™tre trouv√© https://sphinxcontrib-napoleon.readthedocs.io/en/latest/example_google.html#example-google[dans le d√©p√¥t sphinxcontrib-napoleon].

Pour ceux que cela pourrait int√©resser, il existe https://marketplace.visualstudio.com/items?itemName=njpwerner.autodocstring[une extension pour Codium], comme nous le verrons juste apr√®s, qui permet de g√©n√©rer automatiquement le squelette de documentation d'un bloc de code:

.autodocstring
image::images/environment/python-docstring-vscode.png[]

=== Environnement de d√©veloppement

Concr√®tement, nous pourrions tout √† fait nous limiter √† Notepad ou Notepad++.
Mais √† moins d'aimer se fouetter avec un c√¢ble USB, nous appr√©cions la compl√©tion du code, la coloration syntaxique, l'int√©gration des tests unitaires et d'un debugger, ainsi que deux-trois sucreries qui feront plaisir √† n'importe quel d√©veloppeur.

Si vous manquez d'id√©es ou si vous ne savez pas par o√π commencer:

* https://vscodium.com/[VSCodium], avec les plugins https://marketplace.visualstudio.com/items?itemName=ms-python.python[Python]et https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens[GitLens]
* https://www.jetbrains.com/pycharm/[PyCharm]
* https://www.vim.org/[Vim] avec les plugins https://github.com/davidhalter/jedi-vim[Jedi-Vim] et https://github.com/preservim/nerdtree[nerdtree]

Si vous h√©sitez, et m√™me si Codium n'est pas le plus l√©ger (la faute √† https://www.electronjs.org/[Electron]...), il fera correctement son travail (√† savoir: faciliter le v√¥tre), en int√©grant suffisament de fonctionnalit√©s qui g√¢teront les papilles √©moustill√©es du d√©veloppeur impatient.

.Codium en action
image::images/environment/codium.png[]

=== Un terminal

_A priori_, les IDE footnote:[Integrated Development Environment] propos√©s ci-dessus fournissent par d√©faut ou _via_ des greffons un terminal int√©gr√©.
Ceci dit, disposer d'un terminal s√©par√© facilite parfois certaines t√¢ches.

A nouveau, si vous manquez d'id√©es:

. Si vous √™tes sous Windows, t√©l√©chargez une copie de https://cmder.net/[Cmder]. Il n'est pas le plus rapide, mais propose une int√©gration des outils Unix communs (`ls`, `pwd`, `grep`, `ssh`, `git`, ...) sans trop se fouler.
. Pour tout autre syst√®me, vous devriez disposer en natif de ce qu'il faut.

.Mise en ab√Æme
image::images/environment/terminal.png[]

=== Un gestionnaire de base de donn√©es

Django g√®re plusieurs moteurs de base de donn√©es.
Certains sont g√©r√©s nativement par Django (PostgreSQL, MariaDB, SQLite); _a priori_, ces trois-l√† sont disponibles pour tous les syst√®mes d'exploitation. D'autres moteurs n√©cessitent des librairies tierces (Oracle, Microsoft SQL Server).

Il n'est pas obligatoire de disposer d'une application de gestion pour ces moteurs: pour les cas d'utilisation simples, le shell Django pourra largement suffire (nous y reviendrons).
Mais pour faciliter la gestion des bases de donn√©es elles-m√™me, et si vous n'√™tes pas √† l'aise avec la ligne de commande, choisissez l'une des applications d'administration ci-dessous en fonction du moteur de base de donn√©es que vous souhaitez utiliser.

* Pour *PostgreSQL*, il existe https://www.pgadmin.org/[pgAdmin]
* Pour *MariaDB* ou *MySQL*, partez sur https://www.phpmyadmin.net/[PHPMyAdmin]
* Pour *SQLite*, il existe https://sqlitebrowser.org/[SQLiteBrowser]
PHPMyAdmin ou PgAdmin.


=== Un gestionnaire de mots de passe

Nous en auront besoin pour g√©(n√©)rer des phrases secr√®tes pour nos applications.
Si vous n'en utilisez pas d√©j√† un, partez sur https://keepassxc.org/[KeepassXC]: il est multi-plateformes, suivi et s'int√®gre correctement aux diff√©rents environnements, tout en restant accessible.

image::images/environment/keepass.png[]


=== Un syst√®me de gestion de versions

Il existe plusieurs syst√®mes de gestion de versions.
Le plus connu √† l'heure actuelle est https://git-scm.com/[Git], notamment pour sa (tr√®s) grande flexibilit√© et sa rapidit√© d'ex√©cution.
Il est une aide pr√©cieuse pour d√©velopper rapidement des preuves de concept, switcher vers une nouvelle fonctionnalit√©, un bogue √† r√©parer ou une nouvelle release √† proposer au t√©l√©chargement.
Ses deux plus gros d√©fauts concerneraient peut-√™tre sa courbe d'apprentissage pour les nouveaux venus et la complexit√© des actions qu'il permet de r√©aliser.

.https://xkcd.com/1597/
image::images/xkcd-1597-git.png[]

M√™me pour un d√©veloppeur solitaire, un syst√®me de gestion de versions (quel qu'il soit) reste indispensable.

Chaque "*branche*" correspond √† une t√¢che √† r√©aliser: un bogue √† corriger (_Hotfix A_), une nouvelle fonctionnalit√© √† ajouter ou un "_truc √† essayer_" footnote:[Oui, comme dans "Attends, j'essaie vite un truc, si √ßa marche, c'est beau."] (_Feature A_ et _Feature B_).
Chaque "*commit*" correspond √† une sauvegarde atomique d'un √©tat ou d'un ensemble de modifications coh√©rentes entre elles.footnote:[Il convient donc de s'abstenir de modifier le CSS d'une application et la couche d'acc√®s √† la base de donn√©es, sous peine de se faire huer par ses relecteurs au prochain stand-up.]
De cette mani√®re, il est beaucoup plus facile pour le d√©veloppeur de se concenter sur un sujet en particulier, dans la mesure o√π celui-ci ne doit pas obligatoirement √™tre cl√¥tur√© pour appliquer un changement de contexte.

.Git en action
image::images/diagrams/git-workflow.png[]

Cas pratique: vous d√©veloppez cette nouvelle fonctionnalit√© qui va r√©volutionner le monde de demain et d'apr√®s-demain, quand, tout √† coup (!), vous vous rendez compte que vous avez perdu votre conformit√© aux normes PCI parce les donn√©es des titulaires de cartes ne sont pas isol√©es correctement.
Il suffit alors de

. sauver le travail en cours (`git add . && git commit -m [WIP]`)
. revenir sur la branche principale (`git checkout main`)
. cr√©er un "hotfix" (`git checkout -b hotfix/pci-compliance`)
. solutionner le probl√®me (sans doute un `;` en trop ?)
. sauver le correctif sur cette branche (`git add . && git commit -m "Did it!"`)
. r√©cup√©rer ce correctif sur la branche principal (`git checkout main && git merge hotfix/pci-compliance`)
. et revenir tranquillou sur votre branche de d√©veloppement pour fignoler ce g√©n√©rateur de noms de dinosaures rigolos que l'univers vous r√©clame √† cor et √† a cri (`git checkout features/dinolol`)

Finalement, sachez qu'il existe plusieurs mani√®res de g√©rer ces flux d'informations.
Les plus connus sont https://www.gitflow.com/[Gitflow] et https://www.reddit.com/r/programming/comments/7mfxo6/a_branching_strategy_simpler_than_gitflow/[Threeflow].